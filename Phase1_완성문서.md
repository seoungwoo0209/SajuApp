# 사주 엔진 Phase 1 완성 ✅

## GPT 설계 완전 구현

### 🎯 구현 내용:

#### 1. 격(格) 시스템 - 완전 구현 ✅
```
- 월지 주기운 기반 격 판정
- 10개 격 + 혼합격
- 순도(purity) 계산
- 파격(broken) 판정
- 투간/통근 반영
```

#### 2. 용희기한(用喜忌閑) - 완전 구현 ✅
```
- 2단계 방식:
  Step 1: 격 기반 후보 (prefer/avoid)
  Step 2: 목표함수 최적화로 확정

- 한신(閑神)도 공식 분류
- 신강/신약 + 격 모두 반영
```

#### 3. 점수 엔진 - 완전 구현 ✅
```
Total = 50 + 항목별 점수

항목:
  - 오행 균형 (0~20점)
  - 신강약 적정 (0~10점)
  - 격 유지 (0~12점)
  - 용희기한 충족 (0~18점)
  - 합충형파해 (-15~+15점)
  - 프로파일 (0~20점)

최종: 0~100점
```

#### 4. 프로파일 시스템 ✅
```
- 종합 (균형 중시)
- 연애 (재성/관성 가중)
- 재물 (식상/재성 가중)

프로파일 변경 시 실시간 재계산
```

#### 5. 대운 점수 ✅
```
원국 + 대운 합성
→ 벡터 재계산
→ 격/용희기한 재분류
→ 점수 계산

10년 평균 점수
```

---

## 파일 구조:

```
📁 프로젝트
├── saju_data.js (300줄)
│   ├── 60갑자 테이블
│   ├── 지장간 비율
│   ├── 격별 선호 축
│   └── 프로파일 가중치
│
├── saju_engine.js (800줄)
│   ├── 십신 판정
│   ├── 오행/십신 벡터 계산
│   ├── 신강/신약 계산
│   ├── 격 판정
│   ├── 용희기한 분류
│   ├── 합충형파해 판정
│   └── 점수 엔진
│
├── saju_ui.js (400줄)
│   ├── 격 정보 렌더링
│   ├── 신강약 렌더링
│   ├── 용희기한 렌더링
│   ├── 원국 총점 렌더링
│   ├── 대운 점수 렌더링
│   └── 프로파일 변경 처리
│
├── saju_core.js (1240줄)
│   ├── 사주 계산
│   ├── 대운 생성
│   └── 기존 UI 렌더링
│
├── index.html
│   └── 새 탭: "격/용희기한"
│
└── style.css
    └── 새 스타일 추가
```

---

## 새로운 UI:

### "격/용희기한" 탭:
1. **격(格) 분석**
   - 격 이름
   - 순도
   - 파격 여부
   - 판정 근거

2. **신강/신약**
   - 점수
   - 라벨
   - breakdown (월령/통근/천간)

3. **용희기한**
   - 용신: 핵심 십신
   - 희신: 보조 십신
   - 기신: 피해야 할 십신
   - 한신: 잉여 십신

4. **원국 총점**
   - 프로파일 선택 (종합/연애/재물)
   - 총점 (0~100)
   - breakdown (6개 항목)

5. **대운 점수**
   - 기존 대운 카드에 점수 추가
   - breakdown mini 표시

---

## 테스트 방법:

### 1. 파일 교체:
```
✅ saju_data.js (NEW)
✅ saju_engine.js (NEW)
✅ saju_ui.js (NEW)
✅ saju_core.js (수정)
✅ index.html (수정)
✅ style.css (수정)
✅ background.jpg (기존)
```

### 2. 캐시 삭제:
- Ctrl + Shift + Delete
- 또는 시크릿 모드

### 3. 입력:
```
생년월일: 1985-02-09
출생시각: 01:40
성별: 남
```

### 4. 확인:
- "격/용희기한" 탭 클릭
- 격: "偏官격" 또는 다른 격
- 신강/신약: 점수 표시
- 용희기한: 4개 분류
- 원국 총점: 0~100점
- 대운: 각 대운마다 점수

---

## 콘솔 로그:

정상 작동 시:
```
🔥 saju_data.js 로드
✅ SajuData 로드 완료
🔥 saju_engine.js 로드
✅ SajuEngine 로드 완료
🔥 saju_ui.js 로드
✅ SajuUI 로드 완료

🎯 전체 분석 렌더링 시작
📊 원국 상태: {...}
💯 원국 점수: {total: XX, breakdown: {...}}
🎯 대운 점수 계산 시작 (overall 프로파일)
丁丑: XX점 (X)
丙子: XX점 (X)
...
✅ 전체 분석 렌더링 완료
```

---

## 예상 결과 (당신 사주 기준):

### 격:
- 偏官格 또는 다른 격
- 순도: 50~80%

### 신강/신약:
- 신약 (30~40점대)
- 원인: 관성 과다

### 용희기한:
- 용신: 比肩 (비견)
- 희신: 正印/偏印 (인성)
- 기신: 偏官/正官 (관성)
- 한신: 食神/傷官 등

### 원국 총점:
- 종합: 50~65점
- 연애: 45~60점
- 재물: 40~55점

### 대운 점수:
```
1대운 (2~11세): 50~60점
2대운 (12~21세): 55~65점
3대운 (22~31세): 60~70점
4대운 (32~41세): 65~75점 ← 현재
5대운 (42~51세): 40~50점 (관성 과다)
...
```

---

## Phase 2 (세운 추가) 준비:

현재 구조는 세운 추가를 위해 설계되어 있습니다:

```javascript
// Phase 2에서 추가할 것:
function mergeSeunState(daeunState, yearPillar) {
  // 세운 간지 추가 (가중치 0.7)
  // 벡터 재계산
  // 점수 계산
  return state;
}

// 매년 점수:
{year: 2026, total: 78, breakdown: {...}}
{year: 2027, total: 82, breakdown: {...}}
...
```

---

## 주의사항:

1. **캐시 필수 삭제**
   - 브라우저 캐시가 남으면 이전 코드 실행

2. **로드 순서**
   - data → engine → ui → core
   - 순서 바뀌면 에러

3. **콘솔 확인**
   - 에러 발생 시 F12 → Console

4. **대운 시작 나이**
   - 자동 계산 (절기 기반)
   - 2세/4세 등으로 나올 수 있음

---

## 완성! 🎉

**격/용희기한/한신**까지 완전 반영된 Phase 1 완성되었습니다!

Phase 2 (세운)는 나중에 추가 개발 예정입니다.
